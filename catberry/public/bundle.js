/* catberry-project: 0.0.0 */
!function e(t,r,n){function o(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var p=r[s]={exports:{}};t[s][0].call(p.exports,function(e){var r=t[s][1][e];return o(r?r:e)},p,p.exports,e,t,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(e){"use strict";var t=e("catberry"),r=e("catberry-jade"),n=e("./config/environment.json"),o=t.create(n);r.register(o.locator),o.startWhenReady()},{"./config/environment.json":7,catberry:19,"catberry-jade":9}],2:[function(e,t){"use strict";function r(){}t.exports=r},{}],3:[function(e,t){"use strict";function r($config){this._config=$config}t.exports=r,r.prototype._config=null,r.prototype.render=function(){return this._config}},{}],4:[function(e,t){"use strict";function r(){}t.exports=r,r.prototype.render=function(){var e=this;return this.$context.getStoreData().then(function(t){return{user:t.users[e.$context.attributes.index]}})}},{}],5:[function(e,t){"use strict";function r(){}t.exports=r,r.prototype.render=function(){return this.$context.getStoreData()}},{}],6:[function(e,t){"use strict";function r(e,t){this.name=e,this.email=t}function n(){}t.exports=n;var o=[new r("tj","tj@vision-media.ca"),new r("ciaran","ciaranj@gmail.com"),new r("aaron","aaron.heckmann+github@gmail.com")];n.prototype.$lifetime=6e4,n.prototype.load=function(){return{users:o}}},{}],7:[function(e,t){t.exports={title:"Catberry Project",server:{port:3001},logger:{levels:""}}},{}],8:[function(e,t){"use strict";function r($jade){this._jade=$jade,this._templates={}}t.exports=r,r.prototype._jade=null,r.prototype._templates=null,r.prototype.registerCompiled=function(e,t){var r=new Function("jade","return "+t+";");this._templates[e]=r(this._jade)},r.prototype.render=function(e,t){if(!this._templates.hasOwnProperty(e))return Promise.reject(new Error("No such template"));var r;try{r=Promise.resolve(this._templates[e](t))}catch(n){r=Promise.reject(n)}return r}},{}],9:[function(e,t){"use strict";var r=e("jade"),n=e("./lib/TemplateProvider");t.exports={register:function(e,t){t=t||{},e.registerInstance("jade",r),e.register("templateProvider",n,t,!0)},Jade:r,TemplateProvider:n}},{"./lib/TemplateProvider":8,jade:10}],10:[function(e,t,r){(function(n){!function(e){if("object"==typeof r&&"undefined"!=typeof t)t.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o;"undefined"!=typeof window?o=window:"undefined"!=typeof n?o=n:"undefined"!=typeof self&&(o=self),o.jade=e()}}(function(){return function t(r,n,o){function i(a,u){if(!n[a]){if(!r[a]){var c="function"==typeof e&&e;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var l=n[a]={exports:{}};r[a][0].call(l.exports,function(e){var t=r[a][1][e];return i(t?t:e)},l,l.exports,t,r,n,o)}return n[a].exports}for(var s="function"==typeof e&&e,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,r){"use strict";function n(e){return null!=e&&""!==e}function o(e){return(Array.isArray(e)?e.map(o):e&&"object"==typeof e?Object.keys(e).filter(function(t){return e[t]}):[e]).filter(n).join(" ")}r.merge=function i(e,t){if(1===arguments.length){for(var r=e[0],o=1;o<e.length;o++)r=i(r,e[o]);return r}var s=e["class"],a=t["class"];(s||a)&&(s=s||[],a=a||[],Array.isArray(s)||(s=[s]),Array.isArray(a)||(a=[a]),e["class"]=s.concat(a).filter(n));for(var u in t)"class"!=u&&(e[u]=t[u]);return e},r.joinClasses=o,r.cls=function(e,t){for(var n=[],i=0;i<e.length;i++)n.push(t&&t[i]?r.escape(o([e[i]])):o(e[i]));var s=o(n);return s.length?' class="'+s+'"':""},r.style=function(e){return e&&"object"==typeof e?Object.keys(e).map(function(t){return t+":"+e[t]}).join(";"):e},r.attr=function(e,t,n,o){return"style"===e&&(t=r.style(t)),"boolean"==typeof t||null==t?t?" "+(o?e:e+'="'+e+'"'):"":0==e.indexOf("data")&&"string"!=typeof t?(-1!==JSON.stringify(t).indexOf("&")&&console.warn("Since Jade 2.0.0, ampersands (`&`) in data attributes will be escaped to `&amp;`"),t&&"function"==typeof t.toISOString&&console.warn("Jade will eliminate the double quotes around dates in ISO form after 2.0.0")," "+e+"='"+JSON.stringify(t).replace(/'/g,"&apos;")+"'"):n?(t&&"function"==typeof t.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+r.escape(t)+'"'):(t&&"function"==typeof t.toISOString&&console.warn("Jade will stringify dates in ISO form after 2.0.0")," "+e+'="'+t+'"')},r.attrs=function(e,t){var n=[],i=Object.keys(e);if(i.length)for(var s=0;s<i.length;++s){var a=i[s],u=e[a];"class"==a?(u=o(u))&&n.push(" "+a+'="'+u+'"'):n.push(r.attr(a,u,!1,t))}return n.join("")},r.escape=function(e){var t=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");return t===""+e?e:t},r.rethrow=function s(t,r,n,o){if(!(t instanceof Error))throw t;if(!("undefined"==typeof window&&r||o))throw t.message+=" on line "+n,t;try{o=o||e("fs").readFileSync(r,"utf8")}catch(i){s(t,null,n)}var a=3,u=o.split("\n"),c=Math.max(n-a,0),p=Math.min(u.length,n+a),a=u.slice(c,p).map(function(e,t){var r=t+c+1;return(r==n?"  > ":"    ")+r+"| "+e}).join("\n");throw t.path=r,t.message=(r||"Jade")+":"+n+"\n"+a+"\n\n"+t.message,t}},{fs:2}],2:[function(){},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{fs:51}],11:[function(e,t){"use strict";function r(){o.call(this)}t.exports=r;{var n=e("util"),o=e("../lib/base/CatberryBase");e("catberry-locator")}n.inherits(r,o),r.prototype._router=null,r.prototype.wrapDocument=function(){this._router=this.locator.resolve("requestRouter")},r.prototype.startWhenReady=function(){if(window.catberry)return Promise.resolve();var e=this;return new Promise(function(t){window.document.addEventListener("DOMContentLoaded",function(){e.wrapDocument(),window.catberry=e,t()})})}},{"../lib/base/CatberryBase":24,"catberry-locator":34,util:56}],12:[function(e,t){"use strict";function r($window){o.call(this),this._window=$window}t.exports=r;var n=e("util"),o=e("../lib/base/CookieWrapperBase");n.inherits(r,o),r.prototype._window=null,r.prototype.get=function(e){if("string"!=typeof e)return"";if(!this._window.document.cookie)return"";var t=this._parseCookieString(this._window.document.cookie.toString());return t[e]||""},r.prototype.set=function(e){var t=this._convertToCookieSetup(e);return this._window.document.cookie=t,t}},{"../lib/base/CookieWrapperBase":25,util:56}],13:[function(e,t){"use strict";function r($serviceLocator){p.call(this,$serviceLocator),this._componentInstances={},this._componentElements={},this._componentBindings={},this._currentChangedStores={},this._window=$serviceLocator.resolve("window"),this._config=$serviceLocator.resolve("config"),this._storeDispatcher=$serviceLocator.resolve("storeDispatcher");var e=this;this._eventBus.on("storeChanged",function(t){e._currentChangedStores[t]=!0,e._isStateChanging||e._updateStoreComponents()}),setTimeout(function(){e._initialWrap()},0)}function n(e){for(var t={},r=0;r<e.length;r++)t[e[r].name]=e[r].value;return t}function o(e){return e.tagName===m.HEAD?l:e.getAttribute(c.ATTRIBUTE_ID)}function i(e){var t=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.oMatchesSelector||e.msMatchesSelector;return t.bind(e)}function s(e,t){var r=Object.create(e),n=[],o={};for(var i in e)n.push(i);return n.forEach(function(t){return"function"==typeof e[t]?void(o[t]={get:function(){return e[t].bind(e)}}):void(o[t]={get:function(){return e[t]},set:function(r){e[t]=r}})}),o.currentTarget={get:t},Object.defineProperties(r,o),Object.seal(r),Object.freeze(r),r}t.exports=r;var a=e("util"),u=e("../lib/helpers/errorHelper"),c=e("../lib/helpers/moduleHelper"),p=e("../lib/base/DocumentRendererBase");a.inherits(r,p);var l="$$head",f="Tag name should be a string and attributes should be an object",h='Component for tag "%s" not found',d="The ID is not specified or already used",m={TITLE:"TITLE",HTML:"HTML",HEAD:"HEAD",BASE:"BASE",STYLE:"STYLE",SCRIPT:"SCRIPT",NOSCRIPT:"NOSCRIPT",META:"META",LINK:"LINK"},y={ELEMENT_NODE:1,TEXT_NODE:3,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8};r.prototype._config=null,r.prototype._storeDispatcher=null,r.prototype._componentInstances=null,r.prototype._componentElements=null,r.prototype._componentBindings=null,r.prototype._currentRoutingContext=null,r.prototype._currentChangedStores=null,r.prototype._renderedPromise=null,r.prototype._isUpdating=!1,r.prototype.render=function(e,t){var r=this,n=this._componentLoader.getComponentsByNames();if(this._currentRoutingContext=t,Object.keys(this._componentInstances).forEach(function(e){var t=r._componentInstances[e];t.$context=r._getComponentContext(n[t.$context.name],t.$context.element)}),this._isStateChanging){var o=this._storeDispatcher.setState(e,t);return o.forEach(function(e){r._currentChangedStores[e]=!0}),this._renderedPromise}return this._isStateChanging=!0,this._storeDispatcher.setState(e,t),this._renderedPromise=r._updateStoreComponents()["catch"](function(e){r._eventBus.emit("error",e)}).then(function(){r._isStateChanging=!1}),this._renderedPromise},r.prototype.renderComponent=function(e,t){t=t||this._createRenderingContext([]);var r=this,n=c.getOriginalComponentName(e.tagName),i=e.hasChildNodes(),s=t.components[n],a=o(e),u=this._componentInstances[a];if(!s)return Promise.resolve();if(!a||t.renderedIds.hasOwnProperty(a))return Promise.resolve();t.renderedIds[a]=!0,u||(s.constructor.prototype.$context=this._getComponentContext(s,e),u=this._serviceLocator.resolveInstance(s.constructor,t.config),u.$context=s.constructor.prototype.$context,this._componentInstances[a]=u);var p={name:n,context:u.$context};this._componentElements[a]=e;var l=Date.now();return this._eventBus.emit("componentRender",p),this._unbindAll(e,t)["catch"](function(e){r._eventBus.emit("error",e)}).then(function(){var e=c.getMethodToInvoke(u,"render");return c.getSafePromise(e)}).then(function(e){return s.template.render(e)}).then(function(n){e.tagName===m.HEAD?r._mergeHead(e,n):e.innerHTML=n;var o=r._findComponents(e,t).map(function(e){return r.renderComponent(e,t)});return Promise.all(o)}).then(function(){return p.time=Date.now()-l,r._eventBus.emit("componentRendered",p),r._bindComponent(e)})["catch"](function(t){return r._handleError(e,s,t)}).then(function(){i&&r._collectRenderingGarbage(t)})},r.prototype.getComponentById=function(e){return this._componentInstances[e]||null},r.prototype.collectGarbage=function(){var e=this,t=[];return Object.keys(this._componentElements).forEach(function(r){if(r!==l){var n=e._window.document.getElementById(r);if(!n){var o=e._unbindComponent(e._componentElements[r]).then(function(){delete e._componentElements[r],delete e._componentInstances[r],delete e._componentBindings[r]});t.push(o)}}}),Promise.all(t)},r.prototype.createComponent=function(e,t){if("string"!=typeof e||!t||"object"!=typeof t)return Promise.reject(new Error(f));var r=this._componentLoader.getComponentsByNames(),n=c.getOriginalComponentName(e);if(c.isHeadComponent(n)||c.isDocumentComponent(n)||!r.hasOwnProperty(n))return Promise.reject(new Error(a.format(h,e)));var o=t[c.ATTRIBUTE_ID];if(!o||this._componentInstances.hasOwnProperty(o))return Promise.reject(new Error(d));var i=this._window.document.createElement(e);return Object.keys(t).forEach(function(e){i.setAttribute(e,t[e])}),this.renderComponent(i).then(function(){return i})},r.prototype._collectRenderingGarbage=function(e){var t=this;Object.keys(e.unboundIds).forEach(function(r){e.renderedIds.hasOwnProperty(r)||(delete t._componentElements[r],delete t._componentInstances[r],delete t._componentBindings[r])})},r.prototype._unbindAll=function(e,t){var r=this,n=this._unbindComponent(e);return e.hasChildNodes()?n.then(function(){var n=r._findComponents(e,t).map(function(e){var n=o(e);return t.unboundIds[n]=!0,r._unbindComponent(e)});return Promise.all(n)}):n},r.prototype._unbindComponent=function(e){var t=o(e),r=this,n=this._componentInstances[t];if(!n)return Promise.resolve();this._componentBindings.hasOwnProperty(t)&&(Object.keys(this._componentBindings[t]).forEach(function(n){e.removeEventListener(n,r._componentBindings[t][n].handler)}),delete this._componentBindings[t]);var i=c.getMethodToInvoke(n,"unbind");return c.getSafePromise(i)["catch"](function(e){r._eventBus.emit("error",e)})},r.prototype._bindComponent=function(e){var t=o(e),r=this,n=this._componentInstances[t];if(!n)return Promise.resolve();var i=c.getMethodToInvoke(n,"bind");return c.getSafePromise(i).then(function(o){o&&"object"==typeof o&&(r._componentBindings[t]={},Object.keys(o).forEach(function(i){var s={};Object.keys(o[i]).forEach(function(e){var t=o[i][e];"function"==typeof t&&(s[e]=t.bind(n))}),r._componentBindings[t][i]={handler:r._createBindingHandler(e,s),selectorHandlers:s},e.addEventListener(i,r._componentBindings[t][i].handler)}),r._eventBus.emit("componentBound",{element:e,id:t}))})},r.prototype._createBindingHandler=function(e,t){var r=Object.keys(t);return function(n){var o=s(n,function(){return a}),a=n.target,u=i(a),c=!1;if(r.every(function(e){return u(e)?(c=!0,t[e](o),!1):!0}),!c)for(;a!==e;){a=a.parentNode,u=i(a);for(var p=0;p<r.length;p++)if(u(r[p])){c=!0,t[r[p]](o);break}if(c)break}}},r.prototype._findComponents=function(e,t){var r=[];return t.componentTags.forEach(function(t){for(var n=e.getElementsByTagName(t),o=0;o<n.length;o++)r.push(n[o])}),r},r.prototype._handleError=function(e,t,r){if(this._eventBus.emit("error",r),e.tagName===m.HEAD)return null;if(!this._config.isRelease&&r instanceof Error)e.innerHTML=u.prettyPrint(r,this._window.navigator.userAgent);else{if(t.errorTemplate)return t.errorTemplate.render(r).then(function(t){e.innerHTML=t});e.innerHTML=""}return null},r.prototype._updateStoreComponents=function(){if(this._isUpdating)return Promise.resolve();var e=Object.keys(this._currentChangedStores);if(0===e.length)return Promise.resolve();this._currentChangedStores={};var t=this,r=this._createRenderingContext(e),n=r.roots.map(function(e){return t.renderComponent(e,r)});return this._isUpdating=!0,Promise.all(n)["catch"](function(e){t._eventBus.emit("error",e)}).then(function(){return t._isUpdating=!1,t._eventBus.emit("documentUpdated",e),t._updateStoreComponents()})},r.prototype._mergeHead=function(e,t){var r=this,n=this._window.document.createElement("head");n.innerHTML=t;var o,i,s,a,u,c=this._getHeadMap(e.childNodes),p={};for(i=0;i<n.childNodes.length;i++)switch(o=n.childNodes[i],c.hasOwnProperty(o.nodeName)||(c[o.nodeName]={}),o.nodeName){case m.TITLE:case m.BASE:case m.NOSCRIPT:s=this._getNodeKey(o),u=e.getElementsByTagName(o.nodeName)[0],u?(a=this._getNodeKey(u),e.replaceChild(o,u)):e.appendChild(o),i--;break;case m.STYLE:case m.LINK:case m.SCRIPT:s=r._getNodeKey(o),c[o.nodeName].hasOwnProperty(s)||(e.appendChild(o),i--);break;default:s=r._getNodeKey(o),c[o.nodeName].hasOwnProperty(s)?p[s]=!0:(e.appendChild(o),i--)}c.hasOwnProperty(m.META)&&Object.keys(c[m.META]).forEach(function(t){p.hasOwnProperty(t)||e.removeChild(c[m.META][t])})},r.prototype._getHeadMap=function(e){var t,r,n={},o=this;for(t=0;t<e.length;t++)r=e[t],n.hasOwnProperty(r.nodeName)||(n[r.nodeName]={}),n[r.nodeName][o._getNodeKey(r)]=r;return n},r.prototype._getNodeKey=function(e){var t,r,n=[];if(e.nodeType!==y.ELEMENT_NODE)return e.nodeValue||"";if(e.hasAttributes())for(r=0;r<e.attributes.length;r++)t=e.attributes[r],n.push(t.name+"="+t.value);return n.sort().join("|")+">"+e.textContent},r.prototype._initialWrap=function(){var e,t,r,n,o=this,i=this._componentLoader.getComponentsByNames(),s=[];return Object.keys(i).forEach(function(a){var u=c.getTagNameForComponentName(a),p=o._window.document.getElementsByTagName(u),l=i[a].constructor;for(t=0;t<p.length;t++)e=p[t],r=e.getAttribute(c.ATTRIBUTE_ID),r&&(l.prototype.$context=o._getComponentContext(i[a],e),n=o._serviceLocator.resolveInstance(l,o._config),n.$context=l.prototype.$context,o._componentInstances[r]=n,o._eventBus.emit("componentRendered",{name:a,attributes:n.$context.attributes,context:n.$context}),s.push(o._bindComponent(e)))}),Promise.all(s).then(function(){o._eventBus.emit("documentRendered",o._currentRoutingContext)})},r.prototype._getComponentContext=function(e,t){var r=this,o=t.getAttribute(c.ATTRIBUTE_STORE),i=Object.create(this._currentRoutingContext);return i.element=t,i.name=e.name,i.attributes=n(t.attributes),i.getComponentById=function(e){return r.getComponentById(e)},i.createComponent=function(e,t){return r.createComponent(e,t)},i.collectGarbage=function(){return r.collectGarbage()},i.getStoreData=function(){return r._storeDispatcher.getStoreData(o)},i.sendAction=function(e,t){return r._storeDispatcher.sendAction(o,e,t)},i.sendBroadcastAction=function(e,t){return r._storeDispatcher.sendBroadcastAction(e,t)},i},r.prototype._findRenderingRoots=function(e){var t=this,r=this._window.document.head.getAttribute(c.ATTRIBUTE_STORE),n=this._componentLoader.getComponentsByNames(),i={},s={},a={},u=[];return e.forEach(function(e){s[e]=!0,i[e]=t._window.document.querySelectorAll("["+c.ATTRIBUTE_ID+"]["+c.ATTRIBUTE_STORE+'="'+e+'"]')}),n.hasOwnProperty(c.HEAD_COMPONENT_NAME)&&s.hasOwnProperty(r)&&(a[o(this._window.document.head)]=!0,u.push(this._window.document.head)),e.forEach(function(e){for(var t,r,p,l,f,h,d=0;d<i[e].length;d++){for(t=i[e][d],r=i[e][d].getAttribute(c.ATTRIBUTE_ID),p=t,l=r,h=c.getOriginalComponentName(t.tagName);t.tagName!==m.HTML;)t=t.parentNode,r=o(t),f=t.getAttribute(c.ATTRIBUTE_STORE),f&&s.hasOwnProperty(f)&&n.hasOwnProperty(h)&&(p=t,l=r);a.hasOwnProperty(l)||(a[l]=!0,u.push(p))}}),u},r.prototype._createRenderingContext=function(e){var t=this._componentLoader.getComponentsByNames(),r=Object.keys(t).map(function(e){return c.getTagNameForComponentName(e)});return{config:this._config,renderedIds:{},unboundIds:{},isHeadRendered:!1,bindMethods:[],routingContext:this._currentRoutingContext,components:t,componentTags:r,roots:e?this._findRenderingRoots(e):[]}}},{"../lib/base/DocumentRendererBase":26,"../lib/helpers/errorHelper":28,"../lib/helpers/moduleHelper":29,util:56}],14:[function(e,t){"use strict";function r(e){"object"==typeof e&&(this._levels=e),"string"==typeof e&&(this._levels={},Object.keys(o).forEach(function(t){this._levels[o[t]]=-1!==e.search(o[t])},this)),this.trace=this.trace.bind(this),this.info=this.info.bind(this),this.warn=this.warn.bind(this),this.error=this.error.bind(this),this.fatal=this.fatal.bind(this)}function n(e){try{e instanceof Error||(e="string"==typeof e?new Error(e):new Error),console.error&&console.error(e)}catch(t){n(t)}}t.exports=r;var o={TRACE:"trace",INFO:"info",WARN:"warn",ERROR:"error",FATAL:"fatal"};r.prototype._levels={trace:!0,info:!0,warn:!0,error:!0,fatal:!0},r.prototype.trace=function(e){this._levels.trace&&console.log&&console.log(e)},r.prototype.info=function(e){this._levels.info&&console.info&&console.info(e)},r.prototype.warn=function(e){this._levels.warn&&console.warn&&console.warn(e)},r.prototype.error=function(e){this._levels.error&&n(e)},r.prototype.fatal=function(e){this._levels.fatal&&n(e)}},{}],15:[function(e,t){"use strict";function r($serviceLocator){this._eventBus=$serviceLocator.resolve("eventBus"),this._window=$serviceLocator.resolve("window"),this._documentRenderer=$serviceLocator.resolve("documentRenderer"),this._stateProvider=$serviceLocator.resolve("stateProvider"),this._contextFactory=$serviceLocator.resolve("contextFactory"),this._isHistorySupported=this._window.history&&this._window.history.pushState instanceof Function,this._wrapDocument();var e=this;this._changeState(new o(this._window.location.toString())).then(function(){e._eventBus.emit("ready")})}function n(e){for(;e.nodeName!==u&&e.nodeName!==c;)e=e.parentNode;return e.nodeName===u?e:null}t.exports=r;var o=(e("util"),e("catberry-uri").URI),i={LEFT:0,MIDDLE:1},s="href",a="target",u="A",c="BODY";r.prototype._referrer="",r.prototype._location=null,r.prototype._eventBus=null,r.prototype._contextFactory=null,r.prototype._stateProvider=null,r.prototype._documentRenderer=null,r.prototype._window=null,r.prototype._isHistorySupported=!1,r.prototype.route=function(){var e=this;return new Promise(function(t,r){var n=new o(e._window.location.toString()),i=n.authority?n.authority.toString():null,s=e._location.authority?e._location.authority.toString():null;if(n.scheme!==e._location.scheme||i!==s)return void t();var a=n.query?n.query.toString():null,u=e._location.query?e._location.query.toString():null;return n.path===e._location.path&&a===u?(e._location=n,void t()):void e._changeState(n).then(t)["catch"](r)})},r.prototype.go=function(e){var t;try{t=new o(e)}catch(r){t=new o}t=t.resolveRelative(this._location),e=t.toString();var n=this._location.authority?this._location.authority.toString():null,i=t.authority?t.authority.toString():null;if(!this._isHistorySupported||t.scheme!==this._location.scheme||i!==n)return this._window.location.assign(e),Promise.resolve();var s=this._stateProvider.getStateByUri(t);return s?(this._window.history.pushState(s,"",e),this.route()):(this._window.location.assign(e),Promise.resolve())},r.prototype._changeState=function(e){this._location=e;var t=this._stateProvider.getStateByUri(e),r=this._contextFactory.create({referrer:this._referrer||this._window.document.referrer,location:this._location,userAgent:this._window.navigator.userAgent}),n=this;return this._documentRenderer.render(t,r).then(function(){n._referrer=n._location})},r.prototype._wrapDocument=function(){var e=this;this._isHistorySupported&&(this._window.addEventListener("popstate",function(){e.route()["catch"](e._handleError.bind(e))}),this._window.document.body.addEventListener("click",function(t){if(t.target.tagName===u)e._linkClickHandler(t,t.target)["catch"](e._handleError.bind(e));else{var r=n(t.target);if(!r)return;e._linkClickHandler(t,r)["catch"](e._handleError.bind(e))}}))},r.prototype._linkClickHandler=function(e,t){var r=t.getAttribute(a);if(r)return Promise.resolve();if(e.button===i.MIDDLE)return Promise.resolve();var n=t.getAttribute(s);return n?(e.preventDefault(),this.go(n)):Promise.resolve()},r.prototype._handleError=function(e){this._eventBus.emit("error",e)}},{"catberry-uri":38,util:56}],16:[function(e,t){"use strict";function r($serviceLocator){this._serviceLocator=$serviceLocator,this._contextFactory=$serviceLocator.resolve("contextFactory"),this._eventBus=$serviceLocator.resolve("eventBus"),this._templateProvider=$serviceLocator.resolve("templateProvider")}t.exports=r;var n=e("../../lib/helpers/moduleHelper");r.prototype._contextFactory=null,r.prototype._eventBus=null,r.prototype._serviceLocator=null,r.prototype._templateProvider=null,r.prototype._loadedComponents=null,r.prototype.load=function(){var e=this,t={};return this._serviceLocator.resolveAll("component").forEach(function(r){var o=Object.create(e._contextFactory.createStub());if(o.name=r.name,r.constructor.prototype.$context=o,t[r.name]=Object.create(r),e._templateProvider.registerCompiled(r.name,r.templateSource),t[r.name].template={render:function(t){return e._templateProvider.render(r.name,t)}},"string"==typeof r.errorTemplateSource){var i=n.getNameForErrorTemplate(r.name);e._templateProvider.registerCompiled(i,r.errorTemplateSource),t[r.name].errorTemplate={render:function(t){return e._templateProvider.render(i,t)}}}e._eventBus.emit("componentLoaded",t[r.name])}),this._loadedComponents=t,this._eventBus.emit("allComponentsLoaded",t),Promise.resolve(t)},r.prototype.getComponentsByNames=function(){return this._loadedComponents||{}}},{"../../lib/helpers/moduleHelper":29}],17:[function(e,t){"use strict";function r($serviceLocator){this._serviceLocator=$serviceLocator,this._eventBus=$serviceLocator.resolve("eventBus"),this._contextFactory=$serviceLocator.resolve("contextFactory")}t.exports=r,r.prototype._contextFactory=null,r.prototype._eventBus=null,r.prototype._serviceLocator=null,r.prototype._loadedStores=null,r.prototype.load=function(){var e=this,t={};return this._serviceLocator.resolveAll("store").forEach(function(r){var n=Object.create(e._contextFactory.createStub());n.name=r.name,r.constructor.prototype.$context=n,t[r.name]=r,e._eventBus.emit("storeLoaded",t[r.name])}),this._loadedStores=t,this._eventBus.emit("allStoresLoaded",t),Promise.resolve(t)},r.prototype.getStoresByNames=function(){return this._loadedStores||{}}},{}],18:[function(e,t){"use strict";function r($serviceLocator){i.call(this,$serviceLocator),o.defineReadOnly(this,"isBrowser",!0),o.defineReadOnly(this,"isServer",!1)}t.exports=r;{var n=e("util"),o=e("../../lib/helpers/propertyHelper"),i=e("../../lib/base/ModuleApiProviderBase");e("../../lib/helpers/moduleHelper")}n.inherits(r,i),r.prototype.redirect=function(e){var t=this._serviceLocator.resolve("requestRouter");return t.go(e)},r.prototype.clearFragment=function(){var e=this._serviceLocator.resolve("window"),t=e.document.body.scrollTop;return e.location.hash="",e.document.body.scrollTop=t,Promise.resolve()}},{"../../lib/base/ModuleApiProviderBase":27,"../../lib/helpers/moduleHelper":29,"../../lib/helpers/propertyHelper":30,util:56}],19:[function(e,t){"use strict";t.exports=e("./lib/Bootstrapper")},{"./lib/Bootstrapper":57}],20:[function(e,t){"use strict";function r($serviceLocator){this._serviceLocator=$serviceLocator}t.exports=r;var n=e("catberry-uri").URI,o=e("./helpers/propertyHelper");r.prototype._serviceLocator=null,r.prototype.create=function(e){var t=this._serviceLocator.resolve("moduleApiProvider"),r=Object.create(t);return r.cookie=this._serviceLocator.resolve("cookieWrapper"),Object.keys(e).forEach(function(t){o.defineReadOnly(r,t,e[t])}),r},r.prototype.createStub=function(){return this.create({referrer:new n,location:new n,userAgent:""})}},{"./helpers/propertyHelper":30,"catberry-uri":38}],21:[function(e,t){"use strict";function r(){this._emitter=new n.EventEmitter,this._emitter.setMaxListeners(0),this._toInvoke={},this._inProgress={}}t.exports=r;var n=e("events"),o="There is no such registered method";r.prototype._emitter=null,r.prototype._toInvoke=null,r.prototype._inProgress=null,r.prototype.add=function(e,t){this._toInvoke[e]=t},r.prototype.isRegistered=function(e){return"function"==typeof this._toInvoke[e]},r.prototype.invoke=function(e){var t=this;return this.isRegistered(e)?this._inProgress[e]?new Promise(function(r,n){t._emitter.once(e,r),t._emitter.once(e+"--error",n)}):(this._inProgress[e]=!0,this._toInvoke[e]().then(function(r){t._emitter.emit(e,r),t._inProgress[e]=null})["catch"](function(r){t._emitter.emit(e+"--error",r),t._inProgress[e]=null}),this.invoke(e)):Promise.reject(new Error(o))}},{events:52}],22:[function(e,t){"use strict";function r($serviceLocator,$storeLoader,$eventBus){this._serviceLocator=$serviceLocator,this._storeLoader=$storeLoader,this._eventBus=$eventBus,this._storeInstances={},this._lastData={},this._serialWrapper=new o}t.exports=r;var n=e("util"),o=e("./SerialWrapper"),i=e("./helpers/moduleHelper"),s='Store "%s" not found',a="State should be set before any request",u=6e4;r.prototype._serviceLocator=null,r.prototype._eventBus=null,r.prototype._storeLoader=null,r.prototype._storeInstances=null,r.prototype._lastData=null,r.prototype._lastState=null,r.prototype._serialWrapper=null,r.prototype._currentBasicContext=null,r.prototype.getStoreData=function(e){if("string"!=typeof e)return Promise.resolve(null);if(this._lastData.hasOwnProperty(e)){var t=Date.now()-this._lastData[e].createdAt;if(t<=this._lastData[e].lifetime)return Promise.resolve(this._lastData[e].data);delete this._lastData[e]}var r=this,n=u;return r._eventBus.emit("storeDataLoad",{name:e}),this._getStoreInstance(e).then(function(t){return"number"==typeof t.$lifetime&&(n=t.$lifetime),r._serialWrapper.invoke(e)}).then(function(t){return r._lastData[e]={data:t,lifetime:n,createdAt:Date.now()},r._eventBus.emit("storeDataLoaded",{name:e,data:t,lifetime:n}),t})},r.prototype.sendAction=function(e,t,r){var n=this,o={storeName:e,actionName:t,args:r};return this._eventBus.emit("actionSend",o),this._getStoreInstance(e).then(function(e){var n=i.getMethodToInvoke(e,"handle",t);return i.getSafePromise(function(){return n(r)})}).then(function(e){return n._eventBus.emit("actionSent",o),e})},r.prototype.sendBroadcastAction=function(e,t){var r=[],n=this,o=this._storeLoader.getStoresByNames(),s=i.getCamelCaseName("handle",e);return Object.keys(o).forEach(function(i){var a=o[i],u=a.constructor.prototype[s];if("function"==typeof u){var c=n.sendAction(a.name,e,t);r.push(c)}}),Promise.all(r)},r.prototype.setState=function(e,t){if(!this._lastState)return this._currentBasicContext=t,this._lastState=e,[];var r=this,n={};Object.keys(this._lastState).filter(function(t){return!(t in e)}).forEach(function(e){n[e]=!0}),Object.keys(e).forEach(function(t){if(!r._lastState.hasOwnProperty(t))return void(n[t]=!0);var o=Object.keys(r._lastState[t]),i=Object.keys(e[t]);return i.length!==o.length?void(n[t]=!0):void i.every(function(o){return e[t][o]!==r._lastState[t][o]?(n[t]=!0,!1):!0})}),this._lastState=e,this._currentBasicContext!==t&&(this._currentBasicContext=t,Object.keys(this._storeInstances).forEach(function(e){r._storeInstances[e].$context=r._getStoreContext(e)}));var o=this._storeLoader.getStoresByNames(),i=Object.keys(n).filter(function(e){return o.hasOwnProperty(e)});return i.forEach(function(e){delete r._lastData[e],r._eventBus.emit("storeChanged",e)}),this._eventBus.emit("stateChanged",{oldState:this._lastState,newState:e}),i},r.prototype._getStoreContext=function(e){var t=this,r=Object.create(this._currentBasicContext);return r.name=e,r.state=this._lastState[e]||{},r.changed=function(){delete t._lastData[e],t._eventBus.emit("storeChanged",e)},r},r.prototype._getStoreInstance=function(e){if(!this._lastState)return Promise.reject(new Error(a));var t=this._storeInstances[e];if(t)return Promise.resolve(t);var r=this,o=r._storeLoader.getStoresByNames(),u=r._serviceLocator.resolve("config");if(!o.hasOwnProperty(e))return Promise.reject(new Error(n.format(s,e)));var c=o[e].constructor;return c.prototype.$context=r._getStoreContext(e),r._storeInstances[e]=r._serviceLocator.resolveInstance(c,u),r._storeInstances[e].$context=c.prototype.$context,r._serialWrapper.add(e,function(){var t=i.getMethodToInvoke(r._storeInstances[e],"load");return i.getSafePromise(t)}),Promise.resolve(r._storeInstances[e])}},{"./SerialWrapper":21,"./helpers/moduleHelper":29,util:56}],23:[function(e,t){"use strict";function r(e){this._catberryConstructor=e}t.exports=r;var n=e("util"),o=e("../helpers/moduleHelper"),i=e("catberry-uhr"),s=e("promise"),a=e("./../providers/StateProvider"),u=e("../loaders/StoreLoader"),c=e("../loaders/ComponentLoader"),p=e("../DocumentRenderer"),l=e("../RequestRouter"),f=e("../StoreDispatcher"),h=e("../base/ModuleApiProviderBase"),d=e("../providers/ModuleApiProvider"),m=e("../CookieWrapper"),y=e("./../ContextFactory"),v=e("events").EventEmitter,_=(e("catberry-locator"),'Component "%s" loaded'),g='Store "%s" loaded',E="All stores loaded",b="All components loaded",w="Document rendered for URI %s",S='Rendering component "%s" with ID="%s"...',T=" (%d ms)",x='Component "%s" with ID="%s" rendered%s';r.prototype._catberryConstructor=null,r.prototype.create=function(e){var t=e||{},r=new this._catberryConstructor;return this.configure(t,r.locator),r.events=r.locator.resolveInstance(h),r},r.prototype.configure=function(e,t){var r=new v;r.setMaxListeners(0),t.registerInstance("promise",s),t.registerInstance("eventBus",r),t.registerInstance("config",e),t.register("stateProvider",a,e,!0),t.register("contextFactory",y,e,!0),t.register("storeLoader",u,e,!0),t.register("componentLoader",c,e,!0),t.register("documentRenderer",p,e,!0),t.register("requestRouter",l,e,!0),t.register("storeDispatcher",f,e),t.register("moduleApiProvider",d,e,!0),t.register("cookieWrapper",m,e,!0),i.register(t)},r.prototype._wrapEventsWithLogger=function(e,t){e.on("componentLoaded",function(e){t.info(n.format(_,e.name))
}).on("storeLoaded",function(e){t.info(n.format(g,e.name))}).on("allStoresLoaded",function(){t.info(E)}).on("allComponentsLoaded",function(){t.info(b)}).on("componentRender",function(e){var r=e.context.attributes[o.ATTRIBUTE_ID]||"null";t.trace(n.format(S,e.name,r))}).on("componentRendered",function(e){var r=e.context.attributes[o.ATTRIBUTE_ID]||"null";t.trace(n.format(x,e.name,r,"number"==typeof e.time?n.format(T,e.time):""))}).on("documentRendered",function(e){t.info(n.format(w,e.location.toString()))}).on("error",function(e){t.error(e)})}},{"../CookieWrapper":12,"../DocumentRenderer":13,"../RequestRouter":15,"../StoreDispatcher":22,"../base/ModuleApiProviderBase":27,"../helpers/moduleHelper":29,"../loaders/ComponentLoader":16,"../loaders/StoreLoader":17,"../providers/ModuleApiProvider":18,"./../ContextFactory":20,"./../providers/StateProvider":32,"catberry-locator":34,"catberry-uhr":36,events:52,promise:44,util:56}],24:[function(e,t){"use strict";function r(){this.locator=new n,this.locator.registerInstance("serviceLocator",this.locator),this.locator.registerInstance("catberry",this)}t.exports=r;var n=e("catberry-locator");r.prototype.events=null,r.prototype.locator=null},{"catberry-locator":34}],25:[function(e,t){"use strict";function r(){}t.exports=r;e("util");r.prototype._parseCookieString=function(e){var t={};return"string"!=typeof e?t:(e.split(";").forEach(function(e){var r=e.trim().split("=");2===r.length&&(t[r[0]]=decodeURIComponent(r[1]))},this),t)},r.prototype._convertToCookieSetup=function(e){if("string"!=typeof e.key||"string"!=typeof e.value)throw new Error("Wrong key or value");var t=e.key+"="+e.value;return"number"==typeof e.maxAge&&(t+="; Max-Age="+e.maxAge.toFixed(),e.expires||(e.expires=new Date(Date.now()+1e3*e.maxAge))),e.expires instanceof Date&&(t+="; Expires="+e.expires.toUTCString()),"string"==typeof e.path&&(t+="; Path="+e.path),"string"==typeof e.domain&&(t+="; Domain="+e.domain),"boolean"==typeof e.secure&&e.secure&&(t+="; Secure"),"boolean"==typeof e.httpOnly&&e.httpOnly&&(t+="; HttpOnly"),t}},{util:56}],26:[function(e,t){"use strict";function r($serviceLocator){var e=this;this._serviceLocator=$serviceLocator,this._contextFactory=$serviceLocator.resolve("contextFactory"),this._componentLoader=$serviceLocator.resolve("componentLoader"),this._eventBus=$serviceLocator.resolve("eventBus");var t=$serviceLocator.resolve("storeLoader");this._loading=Promise.all([this._componentLoader.load(),t.load()]).then(function(){e._loading=null,e._eventBus.emit("ready")})["catch"](function(t){e._eventBus.emit("error",t)})}t.exports=r,r.prototype._serviceLocator=null,r.prototype._componentLoader=null,r.prototype._loading=null,r.prototype._contextFactory=null,r.prototype._getPromiseForReadyState=function(){return this._loading?this._loading:Promise.resolve()}},{}],27:[function(e,t){"use strict";function r($serviceLocator){this._serviceLocator=$serviceLocator,this._eventBus=$serviceLocator.resolve("eventBus")}function n(e,t){if("string"!=typeof e)throw new Error(i);if("function"!=typeof t)throw new Error(s)}function o(){}t.exports=r;var i="Event name should be a string",s="Event handler should be a function";r.prototype._eventBus=null,r.prototype._serviceLocator=null,r.prototype.on=function(e,t){return n(e,t),this._eventBus.on(e,t),this},r.prototype.once=function(e,t){return n(e,t),this._eventBus.once(e,t),this},r.prototype.removeListener=function(e,t){return n(e,t),this._eventBus.removeListener(e,t),this},r.prototype.removeAllListeners=function(e){return n(e,o),this._eventBus.removeAllListeners(e),this}},{}],28:[function(e,t){"use strict";function r(e){return e.replace(i,"&amp;").replace(s,"&lt;").replace(a,"&gt;").replace(u,"&quot;").replace(c,"&#39;").replace(f,"<br/>")}var n=e("util"),o='Catberry@4.3.2 (<a href="https://github.com/catberry/catberry/issues" target="_blank">report an issue</a>)',i=/&/g,s=/</g,a=/>/g,u=/\"/g,c=/\'/g,p=/^(?:[\w$]+): (?:.+)\r?\n/i,l='<span style="color: red; font-size: 16pt; font-weight: bold;">%s%s</span>',f=/\r?\n/g;t.exports={prettyPrint:function(e,t){if(!e||"object"!=typeof e)return"";var i=(new Date).toUTCString()+";<br/>",s=t?t+";<br/>":"",a="string"==typeof e.name?e.name+": ":"",u=String(e.message||""),c=String(e.stack||"").replace(p,""),f=n.format(l,r(a),r(u));return'<div style="background-color: white; font-size: 12pt;">'+i+s+o+"<br/><br/>"+f+"<br/><br/>"+r(c)+"</div>"}}},{util:56}],29:[function(e,t){"use strict";function r(){return Promise.resolve()}var n={COMPONENT_PREFIX:"cat-",COMPONENT_PREFIX_REGEXP:/^cat-/,COMPONENT_ERROR_TEMPLATE_POSTFIX:"--error",DOCUMENT_COMPONENT_NAME:"document",HEAD_COMPONENT_NAME:"head",ATTRIBUTE_ID:"id",ATTRIBUTE_STORE:"cat-store",DEFAULT_LOGIC_FILENAME:"index.js",getNameForErrorTemplate:function(e){return"string"!=typeof e?"":e+n.COMPONENT_ERROR_TEMPLATE_POSTFIX},isDocumentComponent:function(e){return e.toLowerCase()===n.DOCUMENT_COMPONENT_NAME},isHeadComponent:function(e){return e.toLowerCase()===n.HEAD_COMPONENT_NAME},getOriginalComponentName:function(e){return"string"!=typeof e?"":(e=e.toLowerCase(),e===n.HEAD_COMPONENT_NAME?e:e===n.DOCUMENT_COMPONENT_NAME?e:e.replace(n.COMPONENT_PREFIX_REGEXP,""))},getTagNameForComponentName:function(e){if("string"!=typeof e)return"";var t=e.toUpperCase();return e===n.HEAD_COMPONENT_NAME?t:e===n.DOCUMENT_COMPONENT_NAME?t:n.COMPONENT_PREFIX.toUpperCase()+t},getMethodToInvoke:function(e,t,o){if(!e||"object"!=typeof e)return r;var i=n.getCamelCaseName(t,o);return"function"==typeof e[i]?e[i].bind(e):"function"==typeof e[t]?e[t].bind(e,o):r},getCamelCaseName:function(e,t){if(!t)return"";var r=t.split(/[^a-z0-9]/i),n=String(e||"");return r.forEach(function(e){e&&(n+=n?e[0].toUpperCase():e[0].toLowerCase(),n+=e.substring(1))}),n},getSafePromise:function(e){var t;try{t=Promise.resolve(e())}catch(r){t=Promise.reject(r)}return t}};t.exports=n},{}],30:[function(e,t){"use strict";t.exports={defineReadOnly:function(e,t,r){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:r})}}},{}],31:[function(e,t){"use strict";function r(e){var t=e.split(p);return{name:t[0].trim().substring(1),storeNames:(t[1]?t[1]:"").split(l).map(function(e){return e.trim()}).filter(function(e){return e.length>0})}}function n(e,t){return{expression:e,map:function(r){var n=r.match(e),o={};return!n||n.length<2?o:(n=n.splice(1),t.forEach(function(e,t){e.storeNames.forEach(function(r){var i=n[t];try{i=decodeURIComponent(i)}catch(s){}o[r]||(o[r]={}),o[r][e.name]=i})}),o)}}}var o=/(.+)\/($|\?|#)/,i=/[\-\[\]\{\}\(\)\*\+\?\.\\\^\$\|]/g,s="[$A-Z_][\\dA-Z_$]*",a="(?:(?:\\\\[[ ]*[^\\[\\],]+([ ]*,[ ]*[^\\[\\],]+)*[ ]*\\\\])|(?:\\\\[[ ]*\\\\]))?",u=new RegExp(":"+s+a,"gi"),c="([^\\/\\\\&\\?=]*)",p=/\\\[|\\\]/,l=",";t.exports={removeEndSlash:function(e){return e&&"string"==typeof e?"/"===e?e:e.replace(o,"$1$2"):""},getUriMapperByRoute:function(e){if(!e||"string"!=typeof e)return null;e=t.exports.removeEndSlash(e),e=e.replace(i,"\\$&");var o="^"+e.replace(u,c)+"$",s=e.match(u),a=s&&0!==s.length?s.map(r):[],p=new RegExp(o,"i");return n(p,a)}}},{}],32:[function(e,t){"use strict";function r($serviceLocator){this._uriMappers=n($serviceLocator)}function n(e){var t=[];return e.resolveAll("routeDefinition").forEach(function(e){if("string"==typeof e)return void t.push(o.getUriMapperByRoute(e));if("object"==typeof e&&"string"==typeof e.expression&&e.map instanceof Function){var r=o.getUriMapperByRoute(e.expression);return void t.push({expression:r.expression,map:function(t){var n=r.map(t);return e.map(n)}})}"object"==typeof e&&e.expression instanceof RegExp&&e.map instanceof Function&&t.push(e)}),t}t.exports=r;var o=e("./../helpers/routeHelper");r.prototype._uriMappers=null,r.prototype.getStateByUri=function(e){if(0===this._uriMappers.length)return{};var t=o.removeEndSlash(e.path),r=null;return e.query&&(t+="?"+e.query.toString()),this._uriMappers.some(function(e){return e.expression.test(t)?(r=e.map(t)||{},!0):!1}),r?(Object.keys(r).forEach(function(e){Object.freeze(r[e])}),Object.freeze(r),r):null}},{"./../helpers/routeHelper":31}],33:[function(e,t){"use strict";function r(e){this._source=String(e||"")}t.exports=r;var n={ILLEGAL:-1,NO:0,IDENTIFIER:1,FUNCTION:2,PARENTHESES_OPEN:3,PARENTHESES_CLOSE:4,COMMA:5,END:6};r.STATES=n;var o={FUNCTION:"function"},i=/^\s$/,s=/^[\$\w]$/;r.prototype._source="",r.prototype._currentIndex=0,r.prototype._currentEnd=0,r.prototype._currentState=n.NO,r.prototype.next=function(){if(this._currentState===n.ILLEGAL||this._currentState===n.END)return{state:this._currentState,start:this._currentIndex,end:this._currentIndex+1};var e=this._currentIndex,t=this._currentState;switch(this._currentState){case n.PARENTHESES_OPEN:this.parenthesesOpenState();break;case n.PARENTHESES_CLOSE:this.parenthesesCloseState();break;case n.IDENTIFIER:this.identifierState();break;case n.COMMA:this.commaState();break;case n.FUNCTION:this.functionState();break;default:this.skipWhitespace();var r=this._source.substr(this._currentIndex,o.FUNCTION.length);if(r===o.FUNCTION)return this._currentState=n.FUNCTION,this.next();t=n.ILLEGAL}return{state:t,start:e,end:this._currentEnd}},r.prototype.skipWhitespace=function(){for(;this._currentIndex<this._source.length&&i.test(this._source[this._currentIndex]);)this._currentIndex++},r.prototype.parenthesesOpenState=function(){this._currentIndex++,this._currentEnd=this._currentIndex,this.skipWhitespace(),this._currentState=s.test(this._source[this._currentIndex])?n.IDENTIFIER:")"===this._source[this._currentIndex]?n.PARENTHESES_CLOSE:n.ILLEGAL},r.prototype.parenthesesCloseState=function(){this._currentIndex++,this._currentEnd=this._currentIndex,this._currentState=n.END},r.prototype.functionState=function(){this._currentIndex+=o.FUNCTION.length,this._currentEnd=this._currentIndex,this.skipWhitespace(),this._currentState="("===this._source[this._currentIndex]?n.PARENTHESES_OPEN:s.test(this._source[this._currentIndex])?n.IDENTIFIER:n.ILLEGAL},r.prototype.identifierState=function(){for(;this._currentIndex<this._source.length&&s.test(this._source[this._currentIndex]);)this._currentIndex++;this._currentEnd=this._currentIndex,this.skipWhitespace(),this._currentState="("===this._source[this._currentIndex]?n.PARENTHESES_OPEN:")"===this._source[this._currentIndex]?n.PARENTHESES_CLOSE:","===this._source[this._currentIndex]?n.COMMA:n.ILLEGAL},r.prototype.commaState=function(){return this._currentIndex++,this._currentEnd=this._currentIndex,this.skipWhitespace(),s.test(this._source[this._currentIndex])?void(this._currentState=n.IDENTIFIER):void(this._currentState=n.ILLEGAL)}},{}],34:[function(e,t){"use strict";function r(){this._registrations={}}function n(e,t){t._registrations.hasOwnProperty(e)||(t._registrations[e]=[])}function o(e,t){if(!e.hasOwnProperty(t)||0===e[t].length)throw new Error(l.format(m,t))}function i(e){if(!(e instanceof Function))throw new Error(d)}function s(e){if("string"!=typeof e)throw new Error(l.format(y,e))}function a(e,t){if(e.isSingleton&&null!==e.singleInstance)return e.singleInstance;var r=u(e,t),n=Object.create(e.constructor.prototype);return e.constructor.apply(n,r),e.isSingleton&&(e.singleInstance=n),n}function u(e,t){return e.parameterNames.map(function(t){var r=c(t);return null===r?e.parameters[t]:this.resolve(r)},t)}function c(e){return h.test(e)?e.substr(1,e.length-1):null}function p(e){for(var t=e.toString(),r=new f(t),n=[],o={state:f.STATES.NO,start:0,end:0},i=!1;o.state!==f.STATES.END&&o.state!==f.STATES.ILLEGAL;)o=r.next(),o.state===f.STATES.PARENTHESES_OPEN&&(i=!0),i&&o.state===f.STATES.IDENTIFIER&&n.push(t.substring(o.start,o.end));return n}t.exports=r;var l=e("util"),f=e("./ConstructorTokenizer"),h=/^\$\w+/,d="Constructor should be a function",m='Type "%s" not registered',y='Type name "%s" should be a string';r.prototype._registrations=null,r.prototype.register=function(e,t,r,o){i(t),s(e),n(e,this);var a=p(t);this._registrations[e].unshift({constructor:t,parameters:r||{},parameterNames:a,isSingleton:Boolean(o),singleInstance:null})},r.prototype.registerInstance=function(e,t){s(e),n(e,this),this._registrations[e].unshift({constructor:t.constructor,parameters:{},parameterNames:[],isSingleton:!0,singleInstance:t})},r.prototype.resolve=function(e){s(e),o(this._registrations,e);var t=this._registrations[e][0];return a(t,this)},r.prototype.resolveAll=function(e){s(e);try{o(this._registrations,e)}catch(t){return[]}return this._registrations[e].map(function(e){return a(e,this)},this)},r.prototype.resolveInstance=function(e,t){return a({constructor:e,parameters:t||{},parameterNames:p(e),isSingleton:!1,singleInstance:null},this)},r.prototype.unregister=function(e){s(e),delete this._registrations[e]}},{"./ConstructorTokenizer":33,util:56}],35:[function(e,t){"use strict";function r($window){o.call(this),this.window=$window}function n(e){var t={};return e?(e.getAllResponseHeaders().split("\n").forEach(function(e){var r=e.indexOf(":");if(!(0>=r)){var n=e.substring(0,r).trim().toLowerCase();t[n]=e.substring(r+1).trim()}}),{code:e.status,text:e.statusText,headers:t}):{code:0,text:"",headers:t}}t.exports=r;var o=e("../lib/UHRBase"),i=e("promise"),s=(e("catberry-uri").URI,e("util"));"Promise"in window||(window.Promise=i),s.inherits(r,o);var a={cookie:!0,"accept-charset":!0},u="Connection error",c="Request timeout",p="Request aborted";r.prototype.window=null,r.prototype._doRequest=function(e){var t=this;return Object.keys(e.headers).forEach(function(t){a.hasOwnProperty(t.toLowerCase())&&delete e.headers[t]}),new i(function(r,o){var i=null,s=new t.window.XMLHttpRequest;s.onabort=function(){i=new Error(p),o(i)},s.ontimeout=function(){i=new Error(c),o(i)},s.onerror=function(){i=new Error(s.statusText||u),o(i)},s.onloadend=function(){if(!i){var e=n(s),o=t.convertResponse(e.headers,s.responseText);r({status:e,content:o})}};var a=e.uri.authority.userInfo?e.uri.authority.userInfo.user:null,l=e.uri.authority.userInfo?e.uri.authority.userInfo.password:null;s.open(e.method,e.uri.toString(),!0,a||void 0,l||void 0),s.timeout=e.timeout,Object.keys(e.headers).forEach(function(t){s.setRequestHeader(t,e.headers[t])}),s.send(e.data)})}},{"../lib/UHRBase":37,"catberry-uri":38,promise:44,util:56}],36:[function(e,t){"use strict";var r=e("./lib/UHR");t.exports={register:function(e){var t=e.resolve("config");e.register("uhr",r,t,!0)},UHR:r}},{"./lib/UHR":35}],37:[function(e,t){"use strict";function r(){}function n(e){var t="",r="Content-Type";Object.keys(e).forEach(function(n){"content-type"===n.toLowerCase()&&(r=n,t=e[n])});var n=t.split(";"),o=n[0].toLowerCase();return{name:r,type:o}}t.exports=r;var o=e("catberry-uri"),i=o.Query,s=o.URI,a="Protocol is unsupported",u="Request parameters should be object",c="URL is required parameter",p="Request method is required parameter",l="Host in URL is required",f="Scheme in URL is required",h="Timeout should be a number",d=3e4,m=/^(http)s?$/i,y={GET:"GET",HEAD:"HEAD",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE",OPTIONS:"OPTIONS",TRACE:"TRACE",CONNECT:"CONNECT"};r.TYPES={URL_ENCODED:"application/x-www-form-urlencoded",JSON:"application/json",PLAIN_TEXT:"text/plain",HTML:"text/html"},r.CHARSET="UTF-8",r.DEFAULT_GENERAL_HEADERS={Accept:r.TYPES.JSON+"; q=0.7, "+r.TYPES.HTML+"; q=0.2, "+r.TYPES.PLAIN_TEXT+"; q=0.1","Accept-Charset":r.CHARSET+"; q=1"},r.CHARSET_PARAMETER="; charset="+r.CHARSET,r.URL_ENCODED_ENTITY_CONTENT_TYPE=r.TYPES.URL_ENCODED+r.CHARSET_PARAMETER,r.JSON_ENTITY_CONTENT_TYPE=r.TYPES.JSON+r.CHARSET_PARAMETER,r.PLAIN_TEXT_ENTITY_CONTENT_TYPE=r.TYPES.PLAIN_TEXT+r.CHARSET_PARAMETER,r.prototype.get=function(e,t){t=t||{};var r=Object.create(t);return r.method=y.GET,r.url=e,this.request(r)},r.prototype.post=function(e,t){t=t||{};var r=Object.create(t);return r.method=y.POST,r.url=e,this.request(r)},r.prototype.put=function(e,t){t=t||{};var r=Object.create(t);return r.method=y.PUT,r.url=e,this.request(r)},r.prototype.patch=function(e,t){t=t||{};var r=Object.create(t);return r.method=y.PATCH,r.url=e,this.request(r)},r.prototype["delete"]=function(e,t){var r=Object.create(t);return r.method=y.DELETE,r.url=e,this.request(r)},r.prototype.request=function(e){var t=this;return this._validateRequest(e).then(function(e){return t._doRequest(e)})},r.prototype._validateRequest=function(e){if(!e||"object"!=typeof e)return Promise.reject(new Error(u));var t=Object.create(e);if("string"!=typeof e.url)return Promise.reject(new Error(c));if(t.uri=new s(t.url),!t.uri.scheme)return Promise.reject(new Error(f));if(!m.test(t.uri.scheme))return Promise.reject(new Error(a));if(!t.uri.authority||!t.uri.authority.host)return Promise.reject(new Error(l));if("string"!=typeof t.method||!(t.method in y))return Promise.reject(new Error(p));if(t.timeout=t.timeout||d,"number"!=typeof t.timeout)return Promise.reject(new Error(h));if(t.headers=this._createHeaders(t.headers),!this._isUpstreamRequest(e.method)&&t.data&&"object"==typeof t.data){var r=Object.keys(t.data);r.length>0&&!t.uri.query&&(t.uri.query=new i("")),r.forEach(function(e){t.uri.query.values[e]=t.data[e]}),t.data=null}else{var n=this._getDataToSend(t.headers,t.data);t.headers=n.headers,t.data=n.data}return Promise.resolve(t)},r.prototype._getDataToSend=function(e,t){var o=n(e),s=o.name,a=o.type;if(!t||"object"!=typeof t)return t=t?String(t):"",a||(e[s]=r.PLAIN_TEXT_ENTITY_CONTENT_TYPE),{headers:e,data:t};if(a===r.TYPES.JSON)return{headers:e,data:JSON.stringify(t)};e[s]=r.URL_ENCODED_ENTITY_CONTENT_TYPE;var u=new i;return u.values=t,{headers:e,data:u.toString().replace("%20","+")}},r.prototype._createHeaders=function(e){e&&"object"==typeof e||(e={});var t={};return Object.keys(r.DEFAULT_GENERAL_HEADERS).forEach(function(e){t[e]=r.DEFAULT_GENERAL_HEADERS[e]}),Object.keys(e).forEach(function(r){return null===e[r]||void 0===e[r]?void delete t[r]:void(t[r]=e[r])}),t},r.prototype._doRequest=function(){},r.prototype.convertResponse=function(e,t){"string"!=typeof t&&(t="");var o=n(e),s=o.type||r.TYPES.PLAIN_TEXT;switch(s){case r.TYPES.JSON:var a;try{a=JSON.parse(t)}catch(u){}return a||{};case r.TYPES.URL_ENCODED:var c;try{var p=new i(t.replace("+","%20"));c=p.values}catch(u){}return c||{};default:return t}},r.prototype._isUpstreamRequest=function(e){return e===y.POST||e===y.PUT||e===y.PATCH}},{"catberry-uri":38}],38:[function(e,t){"use strict";t.exports={URI:e("./lib/URI"),Authority:e("./lib/Authority"),UserInfo:e("./lib/UserInfo"),Query:e("./lib/Query")}},{"./lib/Authority":39,"./lib/Query":40,"./lib/URI":41,"./lib/UserInfo":42}],39:[function(e,t){"use strict";function r(e){if("string"==typeof e&&e.length>0){var t=e.indexOf("@");if(-1!==t){var r=e.substring(0,t);this.userInfo=new n(r),e=e.substring(t+1)}var s=e.lastIndexOf(":");if(-1!==s){var a=e.substring(s+1);s===e.length-1?(this.port="",e=e.substring(0,s)):i.test(a)&&(this.port=a,e=e.substring(0,s))}this.host=o.decode(e)}}t.exports=r;var n=e("./UserInfo"),o=e("./percentEncodingHelper"),i=/^\d+$/,s="URI authority port must satisfy expression "+i.toString();r.prototype.userInfo=null,r.prototype.host=null,r.prototype.port=null,r.prototype.clone=function(){var e=new r;return this.userInfo instanceof n&&(e.userInfo=this.userInfo.clone()),"string"==typeof this.host&&(e.host=this.host),"string"==typeof this.port&&(e.port=this.port),e},r.prototype.toString=function(){var e="";if(this.userInfo instanceof n&&(e+=this.userInfo.toString()+"@"),void 0!==this.host&&null!==this.host){var t=String(this.host);e+=o.encodeHost(t)}if(void 0!==this.port&&null!==this.port){var r=String(this.port);if(r.length>0&&!i.test(r))throw new Error(s);e+=":"+r}return e}},{"./UserInfo":42,"./percentEncodingHelper":43}],40:[function(e,t){"use strict";function r(e){"string"==typeof e&&(this.values={},e.split("&").forEach(function(e){var t=e.split("="),r=n.decode(t[0]);if(r){r in this.values&&!(this.values[r]instanceof Array)&&(this.values[r]=[this.values[r]]);var o="string"==typeof t[1]?n.decode(t[1]):null;this.values[r]instanceof Array?this.values[r].push(o):this.values[r]=o}},this))}t.exports=r;var n=e("./percentEncodingHelper");r.prototype.values=null,r.prototype.clone=function(){var e=new r;return this.values&&(e.values={},Object.keys(this.values).forEach(function(t){e.values[t]=this.values[t]},this)),e},r.prototype.toString=function(){if(!this.values)return"";var e="";return Object.keys(this.values).forEach(function(t){var r=this.values[t]instanceof Array?this.values[t]:[this.values[t]];r.forEach(function(r){e+="&"+n.encodeQuerySubComponent(t),void 0!==r&&null!==r&&(r=String(r),e+="="+n.encodeQuerySubComponent(r))})},this),e.replace(/^&/,"")}},{"./percentEncodingHelper":43}],41:[function(e,t){"use strict";function r(e){"string"!=typeof e&&(e="");var t=e.match(c);t&&("string"==typeof t[2]&&(this.scheme=a.decode(t[2])),"string"==typeof t[4]&&(this.authority=new s(t[4])),"string"==typeof t[5]&&(this.path=a.decode(t[5])),"string"==typeof t[7]&&(this.query=new u(t[7])),"string"==typeof t[9]&&(this.fragment=a.decode(t[9])))}function n(e,t){var n=new r("");return t.scheme?(n.scheme=t.scheme,n.authority=t.authority instanceof s?t.authority.clone():t.authority,n.path=i(t.path),n.query=t.query instanceof u?t.query.clone():t.query):(t.authority?(n.authority=t.authority instanceof s?t.authority.clone():t.authority,n.path=i(t.path),n.query=t.query instanceof u?t.query.clone():t.query):(""===t.path?(n.path=e.path,n.query=t.query instanceof u?t.query.clone():e.query instanceof u?e.query.clone():e.query):("/"===t.path[0]?n.path=i(t.path):(n.path=o(e,t),n.path=i(n.path)),n.query=t.query instanceof u?t.query.clone():t.query),n.authority=e.authority instanceof s?e.authority.clone():e.authority),n.scheme=e.scheme),n.fragment=t.fragment,n}function o(e,t){if(e.authority instanceof s&&""===e.path)return"/"+t.path;var r=-1!==e.path.indexOf("/")?e.path.replace(/\/[^\/]+$/,"/"):"";return r+t.path}function i(e){if(!e)return"";for(var t=e,r="",n="",o="";0!==t.length;)if(r=t.replace(/^\.?\.\//,""),r===t)if(r=t.replace(/^((\/\.\/)|(\/\.$))/,"/"),r===t)if(r=t.replace(/^((\/\.\.\/)|(\/\.\.$))/,"/"),r===t){if("."===t||".."===t)break;n=/^\/?[^\/]*(\/|$)/.exec(t)[0],n=n.replace(/([^\/])(\/$)/,"$1"),t=t.substring(n.length),o+=n}else o=o.replace(/\/[^\/]+$/,""),t=r;else t=r;else t=r;return o}t.exports=r;var s=e("./Authority"),a=e("./percentEncodingHelper"),u=e("./Query"),c=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),p=/^[a-z]+[a-z\d\+\.-]*$/i,l="URI scheme must satisfy expression "+p.toString(),f="Scheme component is required to be present in a base URI";r.prototype.scheme=null,r.prototype.authority=null,r.prototype.path=null,r.prototype.query=null,r.prototype.fragment=null,r.prototype.resolveRelative=function(e){if(!e.scheme)throw new Error(f);return n(e,this)},r.prototype.clone=function(){var e=new r;return"string"==typeof this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority.clone()),"string"==typeof this.path&&(e.path=this.path),this.query&&(e.query=this.query.clone()),"string"==typeof this.fragment&&(e.fragment=this.fragment),e},r.prototype.toString=function(){var e="";if(void 0!==this.scheme&&null!==this.scheme){var t=String(this.scheme);if(!p.test(t))throw new Error(l);e+=t+":"}this.authority instanceof s&&(e+="//"+this.authority.toString());var r=void 0===this.path||null===this.path?"":String(this.path);if(e+=a.encodePath(r),this.query instanceof u&&(e+="?"+this.query.toString()),void 0!==this.fragment&&null!==this.fragment){var n=String(this.fragment);e+="#"+a.encodeFragment(n)}return e}},{"./Authority":39,"./Query":40,"./percentEncodingHelper":43}],42:[function(e,t){"use strict";function r(e){if("string"==typeof e&&e.length>0){var t=e.split(":");"string"==typeof t[0]&&(this.user=n.decode(t[0])),"string"==typeof t[1]&&(this.password=n.decode(t[1]))}}t.exports=r;var n=e("./percentEncodingHelper");r.prototype.user=null,r.prototype.password=null,r.prototype.clone=function(){var e=new r;return"string"==typeof this.user&&(e.user=this.user),"string"==typeof this.password&&(e.password=this.password),e},r.prototype.toString=function(){var e="";if(void 0!==this.user&&null!==this.user){var t=String(this.user);e+=n.encodeUserInfoSubComponent(t)}if(void 0!==this.password&&null!==this.password){var r=String(this.password);e+=":"+n.encodeUserInfoSubComponent(r)}return e}},{"./percentEncodingHelper":43}],43:[function(e,t){"use strict";t.exports={encodeUserInfoSubComponent:function(e){return e.replace(/[^\w\.~\-!\$&'\(\)\*\+,;=]/g,encodeURIComponent)},encodeHost:function(e){return e.replace(/[^\w\.~\-!\$&'\(\)\*\+,;=:\[\]]/g,encodeURIComponent)},encodePath:function(e){return e.replace(/[^\w\.~\-!\$&'\(\)\*\+,;=:@\/]/g,encodeURIComponent)},encodeQuerySubComponent:function(e){return e.replace(/[^\w\.~\-!\$'\(\)\*\+,;:@\/\?]/g,encodeURIComponent)},encodeFragment:function(e){return e.replace(/[^\w\.~\-!\$&'\(\)\*\+,;=:@\/\?]/g,encodeURIComponent)},decode:function(e){return decodeURIComponent(e)}}},{}],44:[function(e,t){"use strict";t.exports=e("./lib/core.js"),e("./lib/done.js"),e("./lib/es6-extensions.js"),e("./lib/node-extensions.js")},{"./lib/core.js":45,"./lib/done.js":46,"./lib/es6-extensions.js":47,"./lib/node-extensions.js":48}],45:[function(e,t){"use strict";function r(e){function t(e){return null===u?void p.push(e):void i(function(){var t=u?e.onFulfilled:e.onRejected;if(null===t)return void(u?e.resolve:e.reject)(c);var r;try{r=t(c)}catch(n){return void e.reject(n)}e.resolve(r)})}function r(e){try{if(e===l)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void o(t.bind(e),r,s)}u=!0,c=e,a()}catch(n){s(n)}}function s(e){u=!1,c=e,a()}function a(){for(var e=0,r=p.length;r>e;e++)t(p[e]);p=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var u=null,c=null,p=[],l=this;this.then=function(e,r){return new l.constructor(function(o,i){t(new n(e,r,o,i))})},o(e,r,s)}function n(e,t,r,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n}function o(e,t,r){var n=!1;try{e(function(e){n||(n=!0,t(e))},function(e){n||(n=!0,r(e))})}catch(o){if(n)return;n=!0,r(o)}}var i=e("asap");t.exports=r},{asap:49}],46:[function(e,t){"use strict";var r=e("./core.js"),n=e("asap");t.exports=r,r.prototype.done=function(){var e=arguments.length?this.then.apply(this,arguments):this;e.then(null,function(e){n(function(){throw e})})}},{"./core.js":45,asap:49}],47:[function(e,t){"use strict";function r(e){this.then=function(t){return"function"!=typeof t?this:new n(function(r,n){o(function(){try{r(t(e))}catch(o){n(o)}})})}}var n=e("./core.js"),o=e("asap");t.exports=n,r.prototype=n.prototype;var i=new r(!0),s=new r(!1),a=new r(null),u=new r(void 0),c=new r(0),p=new r("");n.resolve=function(e){if(e instanceof n)return e;if(null===e)return a;if(void 0===e)return u;if(e===!0)return i;if(e===!1)return s;if(0===e)return c;if(""===e)return p;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new n(t.bind(e))}catch(o){return new n(function(e,t){t(o)})}return new r(e)},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,r){function n(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){n(i,e)},r)}t[i]=s,0===--o&&e(t)}catch(u){r(u)}}if(0===t.length)return e([]);for(var o=t.length,i=0;i<t.length;i++)n(i,t[i])})},n.reject=function(e){return new n(function(t,r){r(e)})},n.race=function(e){return new n(function(t,r){e.forEach(function(e){n.resolve(e).then(t,r)})})},n.prototype["catch"]=function(e){return this.then(null,e)}},{"./core.js":45,asap:49}],48:[function(e,t){"use strict";var r=e("./core.js"),n=e("asap");t.exports=r,r.denodeify=function(e,t){return t=t||1/0,function(){var n=this,o=Array.prototype.slice.call(arguments);return new r(function(r,i){for(;o.length&&o.length>t;)o.pop();o.push(function(e,t){e?i(e):r(t)});var s=e.apply(n,o);!s||"object"!=typeof s&&"function"!=typeof s||"function"!=typeof s.then||r(s)})}},r.nodeify=function(e){return function(){var t=Array.prototype.slice.call(arguments),o="function"==typeof t[t.length-1]?t.pop():null,i=this;try{return e.apply(this,arguments).nodeify(o,i)}catch(s){if(null===o||"undefined"==typeof o)return new r(function(e,t){t(s)});n(function(){o.call(i,s)})}}},r.prototype.nodeify=function(e,t){return"function"!=typeof e?this:void this.then(function(r){n(function(){e.call(t,null,r)})},function(r){n(function(){e.call(t,r)})})}},{"./core.js":45,asap:49}],49:[function(e,t){(function(e){function r(){for(;o.next;){o=o.next;var e=o.task;o.task=void 0;var t=o.domain;t&&(o.domain=void 0,t.enter());try{e()}catch(n){if(u)throw t&&t.exit(),setTimeout(r,0),t&&t.enter(),n;setTimeout(function(){throw n},0)}t&&t.exit()}s=!1}function n(t){i=i.next={task:t,domain:u&&e.domain,next:null},s||(s=!0,a())}var o={task:void 0,next:null},i=o,s=!1,a=void 0,u=!1;if("undefined"!=typeof e&&e.nextTick)u=!0,a=function(){e.nextTick(r)};else if("function"==typeof setImmediate)a="undefined"!=typeof window?setImmediate.bind(window,r):function(){setImmediate(r)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=r,a=function(){c.port2.postMessage(0)}}else a=function(){setTimeout(r,0)};t.exports=n}).call(this,e("_process"))},{_process:54}],50:[function(e,t){"use strict";t.exports=["/"]},{}],51:[function(){},{}],52:[function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function o(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,o,a,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],s(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,a=new Array(o-1),u=1;o>u;u++)a[u-1]=arguments[u];r.apply(this,a)}else if(i(r)){for(o=arguments.length,a=new Array(o-1),u=1;o>u;u++)a[u-1]=arguments[u];for(c=r.slice(),o=c.length,u=0;o>u;u++)c[u].apply(this,a)}return!0},r.prototype.addListener=function(e,t){var o;if(!n(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned){var o;o=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),o||(o=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var o=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var r,o,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,o=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);
else if(i(r)){for(a=s;a-->0;)if(r[a]===t||r[a].listener&&r[a].listener===t){o=a;break}if(0>o)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?n(e._events[t])?1:e._events[t].length:0}},{}],53:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],54:[function(e,t){function r(){if(!s){s=!0;for(var e,t=i.length;t;){e=i,i=[];for(var r=-1;++r<t;)e[r]();t=i.length}s=!1}}function n(){}var o=t.exports={},i=[],s=!1;o.nextTick=function(e){i.push(e),s||setTimeout(r,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.on=n,o.addListener=n,o.once=n,o.off=n,o.removeListener=n,o.removeAllListeners=n,o.emit=n,o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],55:[function(e,t){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],56:[function(e,t,r){(function(t,n){function o(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),m(t)?n.showHidden=t:t&&r._extend(n,t),b(n.showHidden)&&(n.showHidden=!1),b(n.depth)&&(n.depth=2),b(n.colors)&&(n.colors=!1),b(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=i),u(n,e,n.depth)}function i(e,t){var r=o.styles[t];return r?"["+o.colors[r][0]+"m"+e+"["+o.colors[r][1]+"m":e}function s(e){return e}function a(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function u(e,t,n){if(e.customInspect&&t&&C(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return g(o)||(o=u(e,o,n)),o}var i=c(e,t);if(i)return i;var s=Object.keys(t),m=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),x(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return p(t);if(0===s.length){if(C(t)){var y=t.name?": "+t.name:"";return e.stylize("[Function"+y+"]","special")}if(w(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(T(t))return e.stylize(Date.prototype.toString.call(t),"date");if(x(t))return p(t)}var v="",_=!1,E=["{","}"];if(d(t)&&(_=!0,E=["[","]"]),C(t)){var b=t.name?": "+t.name:"";v=" [Function"+b+"]"}if(w(t)&&(v=" "+RegExp.prototype.toString.call(t)),T(t)&&(v=" "+Date.prototype.toUTCString.call(t)),x(t)&&(v=" "+p(t)),0===s.length&&(!_||0==t.length))return E[0]+v+E[1];if(0>n)return w(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var S;return S=_?l(e,t,n,m,s):s.map(function(r){return f(e,t,n,m,r,_)}),e.seen.pop(),h(S,v,E)}function c(e,t){if(b(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return _(t)?e.stylize(""+t,"number"):m(t)?e.stylize(""+t,"boolean"):y(t)?e.stylize("null","null"):void 0}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,r,n,o){for(var i=[],s=0,a=t.length;a>s;++s)i.push(j(t,String(s))?f(e,t,r,n,String(s),!0):"");return o.forEach(function(o){o.match(/^\d+$/)||i.push(f(e,t,r,n,o,!0))}),i}function f(e,t,r,n,o,i){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),j(n,o)||(s="["+o+"]"),a||(e.seen.indexOf(c.value)<0?(a=y(r)?u(e,c.value,null):u(e,c.value,r-1),a.indexOf("\n")>-1&&(a=i?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),b(s)){if(i&&o.match(/^\d+$/))return a;s=JSON.stringify(""+o),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e,t,r){var n=0,o=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function d(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function y(e){return null===e}function v(e){return null==e}function _(e){return"number"==typeof e}function g(e){return"string"==typeof e}function E(e){return"symbol"==typeof e}function b(e){return void 0===e}function w(e){return S(e)&&"[object RegExp]"===O(e)}function S(e){return"object"==typeof e&&null!==e}function T(e){return S(e)&&"[object Date]"===O(e)}function x(e){return S(e)&&("[object Error]"===O(e)||e instanceof Error)}function C(e){return"function"==typeof e}function I(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function O(e){return Object.prototype.toString.call(e)}function N(e){return 10>e?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[N(e.getHours()),N(e.getMinutes()),N(e.getSeconds())].join(":");return[e.getDate(),D[e.getMonth()],t].join(" ")}function j(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var L=/%[sdj%]/g;r.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(o(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,i=n.length,s=String(e).replace(L,function(e){if("%%"===e)return"%";if(r>=i)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return e}}),a=n[r];i>r;a=n[++r])s+=y(a)||!S(a)?" "+a:" "+o(a);return s},r.deprecate=function(e,o){function i(){if(!s){if(t.throwDeprecation)throw new Error(o);t.traceDeprecation?console.trace(o):console.error(o),s=!0}return e.apply(this,arguments)}if(b(n.process))return function(){return r.deprecate(e,o).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return i};var A,R={};r.debuglog=function(e){if(b(A)&&(A=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!R[e])if(new RegExp("\\b"+e+"\\b","i").test(A)){var n=t.pid;R[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else R[e]=function(){};return R[e]},r.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=d,r.isBoolean=m,r.isNull=y,r.isNullOrUndefined=v,r.isNumber=_,r.isString=g,r.isSymbol=E,r.isUndefined=b,r.isRegExp=w,r.isObject=S,r.isDate=T,r.isError=x,r.isFunction=C,r.isPrimitive=I,r.isBuffer=e("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",P(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!S(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":55,_process:54,inherits:53}],57:[function(e,t){"use strict";function r(){c.call(this,a)}var n=[{name:"Users",constructor:e("./catberry_stores/Users.js")}],o=[{name:"document",constructor:e("./catberry_components/document/Document.js"),properties:{name:"document",template:"./document.jade",logic:"./Document.js"},templateSource:'function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push("<!DOCTYPE html><html><head></head><body><cat-users id=\\"users\\" cat-store=\\"Users\\"></cat-users></body></html>");;return buf.join("");\n}',errorTemplateSource:null},{name:"head",constructor:e("./catberry_components/head/Head.js"),properties:{name:"head",template:"./head.jade",logic:"./Head.js"},templateSource:'function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push("<title>Jade Example</title><link rel=\\"stylesheet\\" href=\\"/stylesheets/style.css\\"/>");;return buf.join("");\n}',errorTemplateSource:null},{name:"user",constructor:e("./catberry_components/user/index.js"),properties:{name:"user",template:"./template.jade"},templateSource:'function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (user) {\nbuf.push("<div class=\\"user\\"><h2>" + (jade.escape(null == (jade_interp = user.name) ? "" : jade_interp)) + "</h2><div class=\\"email\\">" + (jade.escape(null == (jade_interp = user.email) ? "" : jade_interp)) + "</div></div>");}.call(this,"user" in locals_for_with?locals_for_with.user:typeof user!=="undefined"?user:undefined));;return buf.join("");\n}',errorTemplateSource:null},{name:"users",constructor:e("./catberry_components/users/index.js"),properties:{name:"users",template:"./template.jade"},templateSource:'function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (undefined, users) {\nbuf.push("<h1>Users</h1><div id=\\"users\\">");\n// iterate users\n;(function(){\n  var $obj = users;\n  if (\'number\' == typeof $obj.length) {\n\n    for (var index = 0, $l = $obj.length; index < $l; index++) {\n      var user = $obj[index];\n\nbuf.push("<cat-user" + (jade.attr("id", index, true, false)) + " cat-store=\\"Users\\"" + (jade.attr("index", index, true, false)) + "></cat-user>");\n    }\n\n  } else {\n    var $l = 0;\n    for (var index in $obj) {\n      $l++;      var user = $obj[index];\n\nbuf.push("<cat-user" + (jade.attr("id", index, true, false)) + " cat-store=\\"Users\\"" + (jade.attr("index", index, true, false)) + "></cat-user>");\n    }\n\n  }\n}).call(this);\n\nbuf.push("</div>");}.call(this,"undefined" in locals_for_with?locals_for_with.undefined:typeof undefined!=="undefined"?undefined:undefined,"users" in locals_for_with?locals_for_with.users:typeof users!=="undefined"?users:undefined));;return buf.join("");\n}',errorTemplateSource:null}],i=e("util"),s=e("./routes.js")||[],a=(e("./node_modules/catberry/lib/helpers/moduleHelper.js"),e("./node_modules/catberry/browser/Catberry.js")),u=e("./node_modules/catberry/browser/Logger.js"),c=e("./node_modules/catberry/lib/base/BootstrapperBase.js"),p="Document updated (%d store(s) changed)",l='Component "%s" is bound';i.inherits(r,c),r.prototype.configure=function(e,t){c.prototype.configure.call(this,e,t),"Promise"in window||(window.Promise=t.resolve("promise")),t.registerInstance("window",window);var r=e.logger||{},i=new u(r.levels);t.registerInstance("logger",i),window.onerror=function(e,t,r){return i.fatal(t+":"+r+" "+e),!0};var a=t.resolve("eventBus");this._wrapEventsWithLogger(a,i),s.forEach(function(e){t.registerInstance("routeDefinition",e)}),n.forEach(function(e){t.registerInstance("store",e)}),o.forEach(function(e){t.registerInstance("component",e)})},r.prototype._wrapEventsWithLogger=function(e,t){c.prototype._wrapEventsWithLogger.call(this,e,t),e.on("documentUpdated",function(e){t.info(i.format(p,e.length))}).on("componentBound",function(e){t.info(i.format(l,e.element.tagName.toLowerCase()+"#"+e.id))})},t.exports=new r},{"./catberry_components/document/Document.js":2,"./catberry_components/head/Head.js":3,"./catberry_components/user/index.js":4,"./catberry_components/users/index.js":5,"./catberry_stores/Users.js":6,"./node_modules/catberry/browser/Catberry.js":11,"./node_modules/catberry/browser/Logger.js":14,"./node_modules/catberry/lib/base/BootstrapperBase.js":23,"./node_modules/catberry/lib/helpers/moduleHelper.js":29,"./routes.js":50,util:56}]},{},[1]);